<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register & Login</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="login.css">
</head>
<body>
  <style>
     *{
        margin:0;
        padding:0;
        box-sizing:border-box;
        font-family:"poppins",sans-serif;
    }
    body{
        background-color: #c9d6ff;
        background:linear-gradient(to right,#e2e2e2,#c9d6ff);
    }
    .container{
        background:#fff;
        width:450px;
        padding:1.5rem;
        margin:50px auto;
        border-radius:10px;
        box-shadow:0 20px 35px rgba(0,0,1,0.9);
    }
    form{
        margin:0 2rem;
    }
    .form-title{
        font-size:1.5rem;
        font-weight:bold;
        text-align:center;
        padding:1.3rem;
        margin-bottom:0.4rem;
    }
    input{
        color:inherit;
        width:100%;
        background-color:transparent;
        border:none;
        border-bottom:1px solid #757575;
        padding-left:1.5rem;
        font-size:15px;
    }
    .input-group{
        padding:1% 0;
        position:relative;
    }
    .input-group i{
        position:absolute;
        color:black;
    }
    input:focus{
        background-color: transparent;
        outline:transparent;
        border-bottom:2px solid hsl(327,90%,28%);
    }
    input::placeholder{
        color:transparent;
    }
    label{
        color:#757575;
        position:relative;
        left:1.2em;
        top:-1.3em;
        cursor:auto;
        transition:0.3s ease all;
    }
    input:focus~label,input:not(:placeholder-shown)~label{
        top:-3em;
        color:hsl(327,90%,28%);
        font-size:15px;
    }
    .recover{
        text-align:right;
        font-size:1rem;
        margin-bottom:1rem;
    }
    .recover a{
        text-decoration:none;
        color:rgb(125,125,235);
    }
    .recover a:hover{
        color:blue;
        text-decoration:underline;
    }
    button{
        font-size:1.1rem;
        padding:8px 0;
        border-radius:5px;
        outline:none;
        border:none;
        width:100%;
        background:rgb(125,125,235);
        color:white;
        cursor:pointer;
        transition:0.9s;
    }
    button:hover{
        background:#07001f;
    }
    .or{
        font-size:1.1rem;
        margin-top:0.5rem;
        text-align:center;
    }
    .icons{
        text-align:center;
    }
    .icons i{
        color:rgb(125,125,235);
        padding:0.8rem 1.5rem;
        border-radius:10px;
        font-size:1.5rem;
        cursor:pointer;
        border:2px solid #dfe9f5;
        margin:0 15px;
        transition:1s;
    }
    .icons i:hover{
        background:#07001f;
        font-size:1.6rem;
        border:2px solid rgb(125,125,235);
    }
    .links{
        display:flex;
        justify-content:space-around;
        padding:0 4rem;
        margin-top:0.9rem;
        font-weight:bold;
    }
    #signUpButton, #signInButton{
        color:rgb(125,125,235);
        border:none;
        background-color:transparent;
        font-size:1rem;
        font-weight:bold;
    }
    #signUpButton:hover, #signInButton:hover {
        text-decoration:underline;
        color:blue;
    } 
    .messageDiv{
      font-size: 9px;
      padding: 5px;
      height: auto;
      width: 100%;
      color: white;
      background: red;
      border-radius: 10px;
      border: 1px solid grey;
     
    }
    #signInMessage, #signUpMessage{
      margin-bottom: 34px;
      display: none;
    }
    .role{
      height: 30px;
      background: white;
      align-items: center;
      width: 210px;
      border-radius: 8px;
      margin-bottom: 9px;
      border: 2px solid grey;
    }
    @media only screen and (max-width: 770px) {
       .container{
         width: 90%;
       }
    
  </style>

  <!-- Sign-Up Form -->
  <div class="container" id="signup" style="display:none;">
    <h1 class="form-title">Register</h1>
    <form id="registerForm">
        <div id="signUpMessage" class="messageDiv"></div>
        <div class="input-group">
            <i class="fas fa-user"></i>
            <input type="text" id="fName" placeholder="Full Name" required>
            <label for="fName">Full Name</label>
        </div>
        <div class="input-group">
            <i class="fas fa-envelope"></i>
            <input type="email" id="rEmail" placeholder="Email" required>
            <label for="rEmail">Email</label>
        </div>
        <div class="input-group">
            <i class="fas fa-lock"></i>
            <input type="password" id="rPassword" placeholder="Password" required>
            <label for="rPassword">Password</label>
        </div>
        <div class="input-group">
            <i class="fas fa-phone"></i>
            <input type="text" id="rPhoneNumber" placeholder="Phone Number" required>
            <label for="rPhoneNumber">Phone Number</label>
        </div>
        <div class="input-group">
            <i class="fab fa-whatsapp"></i>
            <input type="text" id="rWhatsAppNumber" placeholder="WhatsApp Number">
            <label for="rWhatsAppNumber">WhatsApp Number</label>
        </div>
        <div class="input-group">
            <i class="fas fa-image"></i>
            <input type="file" id="profilePicture" accept="image/*" required>
            <label for="profilePicture">Profile Picture</label>
        </div>
        <div class="input-group">
            <select class="role" id="role">
                <option value="writer">Author</option>
                <option value="reader">Reader</option>
            </select>
        </div>
        <button class="btn" type="submit">Sign Up</button>
    </form>
    <p class="or">----------or--------</p>
    <div class="links">
        <p>Already Have Account?</p>
        <button id="signInButton">Sign In</button>
    </div>
  </div>

  <!-- Sign-In Form -->
  <div class="container" id="signIn">
    <h1 class="form-title">Sign In</h1>
    <form id="loginForm">
        <div id="signInMessage" class="messageDiv"></div>
        <div class="input-group">
            <i class="fas fa-envelope"></i>
            <input type="email" id="email" placeholder="Email" required>
            <label for="email">Email</label>
        </div>
        <div class="input-group">
            <i class="fas fa-lock"></i>
            <input type="password" id="password" placeholder="Password" required>
            <label for="password">Password</label>
        </div>
        <p class="recover"><a href="#">Recover Password</a></p>
        <button class="btn" type="submit">Sign In</button>
    </form>
    <p class="or">----------or--------</p>

    <div class="links">
        <p>Don't have an account yet?</p>
        <button id="signUpButton">Sign Up</button>
    </div>
  </div>

  <div id="userData"></div> <!-- To display user data -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";
import { getStorage, ref, uploadBytes,getDownloadURL} from "https://www.gstatic.com/firebasejs/10.14.1/firebase-storage.js";
    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyAvwNyhKiKFyI-r6MDDk7BH3iq7P61z594",
        authDomain: "newtalents-a7c29.firebaseapp.com",
        databaseURL: "https://newtalents-a7c29-default-rtdb.firebaseio.com",
        projectId: "newtalents-a7c29",
        storageBucket: "newtalents-a7c29.appspot.com",
        messagingSenderId: "507408992610",
        appId: "1:507408992610:web:05ce220a4cb4922de9843b"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
const storage = getStorage(app);
   // Baza Storage na Firestore
    document.addEventListener("DOMContentLoaded", () => {
        // Toggle between Sign In and Sign Up forms
        document.getElementById("signUpButton").addEventListener("click", () => {
            document.getElementById("signup").style.display = 'block';
            document.getElementById("signIn").style.display = 'none';
        });
        document.getElementById("signInButton").addEventListener("click", () => {
            document.getElementById("signup").style.display = 'none';
            document.getElementById("signIn").style.display = 'block';
        });

        // Handle Sign-Up
        // Register form submit event
document.getElementById("registerForm").addEventListener("submit", async (e) => {
    e.preventDefault();
    const email = document.getElementById("rEmail").value;
    const password = document.getElementById("rPassword").value;
    const fName = document.getElementById("fName").value;
    const phoneNumber = document.getElementById("rPhoneNumber").value;
    const whatsAppNumber = document.getElementById("rWhatsAppNumber").value;
    const role = document.getElementById("role").value;
    const profilePicture = document.getElementById("profilePicture").files[0]; // Get the file

    try {
        // Create user with email and password
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;

        // Upload profile picture to Firebase Storage
        let profilePictureURL = "";
        if (profilePicture) {
            const storageRef = ref(storage, `profilePictures/${user.uid}`);
            await uploadBytes(storageRef, profilePicture);
            profilePictureURL = await getDownloadURL(storageRef); // Get the download URL
        }

        // Prepare user data
        const userData = {
            fName,
            phoneNumber,
            whatsAppNumber,
            role,
            email,
            profilePictureURL, // Add profile picture URL to the data
            createdAt: new Date().toISOString()
        };

        // Access 'userdate' document in Firestore
        const userdateRef = doc(db, "userdate", "data");
        const userdateSnapshot = await getDoc(userdateRef);

        if (userdateSnapshot.exists()) {
            // Update existing document with new user's information
            await updateDoc(userdateRef, { [user.uid]: userData });
        } else {
            // Create a new document with user's data
            await setDoc(userdateRef, { [user.uid]: userData });
        }

        // Save user's first name in localStorage
        localStorage.setItem('username', fName);

        alert("User registered successfully!");
        document.getElementById("signup").style.display = "none";
        document.getElementById("signIn").style.display = "block";
    } catch (error) {
        console.error("Error signing up:", error.message);
        document.getElementById("signUpMessage").textContent = error.message;
        document.getElementById("signUpMessage").style.display = 'block';
    }
});

        // Handle Sign-In
        document.getElementById("loginForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // Access 'userdate' document
                const userdateRef = doc(db, "userdate", "data");
                const userdateSnapshot = await getDoc(userdateRef);

                if (userdateSnapshot.exists()) {
                    const userData = userdateSnapshot.data()[user.uid];
                    const fName = userData?.fName || "";

                    // Save user's first name in localStorage
                    localStorage.setItem('username', fName);
                }

                alert("Signed in successfully!");
                window.location.href = "homepage.html";
            } catch (error) {
                console.error("Error signing in:", error.message);

                // Show error message in the appropriate language
                const messageElement = document.getElementById("signInMessage");
                if (error.code === 'auth/wrong-rpassword') {
                    messageElement.textContent = "Password si yo. Nyamuneka gerageza kongera!";
                } else if (error.code === 'auth/user-not-found') {
                    messageElement.textContent = "Email ntabwo yabonetse. Nyamuneka reba neza cyangwa wandike nshya.";
                } else {
    messageElement.textContent = "Wrong password: " + error.message;
    messageElement.style.color = "white";
    messageElement.style.background = "red";
}

                messageElement.style.display = 'block'; // Ensure the message is visible
            }
        });
    });
    
    
    
    
    
</script>
</script>
 
  
</body>
</html>
